import{b as F}from"./bayar-b8921961.js";import{m}from"./mainLocalStorage-6a318ee8.js";import{B as S,a as V,A as x}from"./arrayPeriod-918edb3d.js";import{R as N}from"./rupiah-c3f0a7c7.js";import{F as O}from"./dateFormat-14868802.js";import{q as H}from"./style-d2e32a19.js";import{a as R,F as J,W as Y,G as q}from"./flowbite-vue-7a61088e.js";import{L as G}from"./LoadingContainer-49b5bdb0.js";import{_ as v}from"./_plugin-vue_export-helper-c27b6911.js";import{o as r,c,t as u,y as W,r as o,s as g,x as z,a as n,b as _,F as p,q as y,u as b,A as E}from"./index-7a3f4d22.js";import"./mainRepositories-174151c3.js";const M={name:"CustomButton",props:{value:Object,check:Boolean},data:()=>({isClicked:null}),mounted:function(){this.isClicked=this.check}};function K(a,e,t,h,l,i){return r(),c("button",{class:W(["rounded-full px-4 text-[13px] font-mulish border-2 border-gray-300 text-white",a.isClicked||t.check?"bg-red-600":"bg-green-600"]),type:"button",onClick:e[0]||(e[0]=k=>a.isClicked=!a.isClicked)},u(a.isClicked||t.check?"Batalkan":"Bayar"),3)}const Q=v(M,[["render",K]]);const f=F(),U={name:"BayarBulananView",components:{VueBottomSheet:H,Accordion:R,AccordionPanel:J,AccordionHeader:Y,AccordionContent:q,LoadingCircle:G,ButtonFilter:S,ButtonFilterYear:V,ButtonBayar:Q},data(){return{listBulanan:[],listPeriod:x.getList(),selectedPeriod:[],sendData:null,isLoading:!1,title:"Pilih Tahun",message:null,history:[],bulan_id:[],totalTagihan:0}},methods:{setDataHistory(){this.sendDataHistory=JSON.stringify({student_nis:m.getAuth().nis,kode_sekolah:m.getAuth().kode_sekolah,bayar:"Bayar",bulan_id:[],bebas_id:[]})},setData(){this.sendData=JSON.stringify({nis:m.getAuth().nis,kode_sekolah:m.getAuth().kode_sekolah,period_id:this.selectedPeriod==null||this.selectedPeriod<1?x.getArray():this.selectedPeriod.map(a=>parseInt(a))})},async getHistory(){this.isLoading=!0,this.setDataHistory();let a=await f.listRingkasan(this.sendDataHistory);var e=JSON.parse(a);console.log("history state"),console.log(e),e.success?(this.isLoading=e.loading,this.message=e.message,this.history=e.data.bulan,this.bulan_id=this.history.map(t=>parseInt(t.bulan_id)),this.totalTagihan=this.history.length==0?0:this.history.map(t=>parseInt(t.nominal)).reduce(function(t,h){return t+h})):(this.isLoading=e.loading,this.message=e.message,this.history=[])},async getListBulanan(){this.isLoading=!0,this.setData();let a=await f.listBulanan(this.sendData);var e=JSON.parse(a);console.log(e),e.success?(this.isLoading=e.loading,this.listBulanan=e.data.detail.map(t=>({nama_bayar:t.detail_bulan.nama_bayar,period_start:t.detail_bulan.period_start,period_end:t.detail_bulan.period_end,items:[{month_name:t.detail_bulan.month_name_jul,bill:t.detail_bulan.bill_jul,status:t.detail_bulan.status_jul,month_id:t.detail_bulan.month_id_jul},{month_name:t.detail_bulan.month_name_agu,bill:t.detail_bulan.bill_agu,status:t.detail_bulan.status_agu,month_id:t.detail_bulan.month_id_agu},{month_name:t.detail_bulan.month_name_sep,bill:t.detail_bulan.bill_sep,status:t.detail_bulan.status_sep,month_id:t.detail_bulan.month_id_sep},{month_name:t.detail_bulan.month_name_okt,bill:t.detail_bulan.bill_okt,status:t.detail_bulan.status_okt,month_id:t.detail_bulan.month_id_okt},{month_name:t.detail_bulan.month_name_nov,bill:t.detail_bulan.bill_nov,status:t.detail_bulan.status_nov,month_id:t.detail_bulan.month_id_nov},{month_name:t.detail_bulan.month_name_des,bill:t.detail_bulan.bill_des,status:t.detail_bulan.status_des,month_id:t.detail_bulan.month_id_des},{month_name:t.detail_bulan.month_name_jan,bill:t.detail_bulan.bill_jan,status:t.detail_bulan.status_jan,month_id:t.detail_bulan.month_id_jan},{month_name:t.detail_bulan.month_name_feb,bill:t.detail_bulan.bill_feb,status:t.detail_bulan.status_feb,month_id:t.detail_bulan.month_id_feb},{month_name:t.detail_bulan.month_name_mar,bill:t.detail_bulan.bill_mar,status:t.detail_bulan.status_mar,month_id:t.detail_bulan.month_id_mar},{month_name:t.detail_bulan.month_name_apr,bill:t.detail_bulan.bill_apr,status:t.detail_bulan.status_apr,month_id:t.detail_bulan.month_id_apr},{month_name:t.detail_bulan.month_name_mei,bill:t.detail_bulan.bill_mei,status:t.detail_bulan.status_mei,month_id:t.detail_bulan.month_id_mei},{month_name:t.detail_bulan.month_name_jun,bill:t.detail_bulan.bill_jun,status:t.detail_bulan.status_jun,month_id:t.detail_bulan.month_id_jun}]})),this.listBulanan=this.listBulanan.map(t=>({nama_bayar:t.nama_bayar,period_start:t.period_start,period_end:t.period_end,items:t.items.filter(h=>h.status!="1"&&h.month_name!="")}))):(this.isLoading=e.loading,this.message=e.error,this.listBulanan=[]),console.log(this.listBulanan)},setSelectedPeriod(a){this.selectedPeriod.length<0?this.selectedPeriod.push(a):this.selectedPeriod.includes(a)?this.selectedPeriod.splice(this.selectedPeriod.indexOf(a),1):this.selectedPeriod.push(a)},async bayar(){if(this.isLoading=!0,this.checkBayar().success==!1)this.isLoading=!1,this.$snackbar.add({type:"error",text:this.checkBayar().error});else{let e=await f.bayarBulanan(this.bulan_id);var a=JSON.parse(e);this.isLoading=a.loading,a.success?(this.isLoading=a.loading,this.$snackbar.add({type:"success",text:a.data}),this.$router.push({name:"ringkasanPembayaran"})):(this.isLoading=a.loading,this.$snackbar.add({type:"error",text:a.error}))}},open(){this.$refs.listPeriod.open()},close(){this.$refs.listPeriod.close()},loadData(){this.setData(),this.getListBulanan(this.sendData),this.close()},getVal(a){this.history.some(e=>e.bulan_id===a.month_id)&&(this.isLoading=!0,this.removeItem(a.month_id),window.location.reload()),this.bulan_id.includes(parseInt(a.month_id))?(this.totalTagihan-=parseInt(a.bill),this.bulan_id.splice(this.bulan_id.indexOf(a.month_id),1)):(this.totalTagihan+=parseInt(a.bill),this.bulan_id.push(parseInt(a.month_id)))},async removeItem(a){await f.removeBulanan(a)},formatRupiah(a){return N.format(a)},formatDateInd(a){return O.fullYearInd(a)},checkBayar(){return this.bulan_id.length<1?{success:!1,error:"Pilih Item Terlebih Dahulu"}:this.totalTagihan<1e4?{success:!1,error:"Minimal Pembayaran Rp. 10.000"}:{success:!0,error:null}}},mounted(){this.getListBulanan(),this.getHistory()}},X={class:"flex flex-col h-100"},Z={class:"bg-primaryColors top-0 sticky w-full"},$={class:"container flex flex-row items-center justify-between"},tt=n("p",{class:"text-center text-white font-[20px] font-mulish py-4"},"Bayar Tagihan",-1),at=n("p",null,null,-1),et={class:"flex-grow pt-4"},nt={class:"container flex flex-col gap-y-5"},st={class:"flex flex-row justify-between items-center"},lt=n("p",{class:"font-mulish"},"Tahun Ajaran",-1),it={class:"flex flex-col"},ot={class:"flex flex-row justify-between"},rt={class:"flex items-center justify-center"},dt={class:"bottom-0 fixed w-full flex justify-center shadow-inner bg-gray-50"},_t={class:"flex flex-col py-2"},ut={class:"flex flex-row justify-between"},ht={class:"font-mulish"},ct={class:"font-mulish"},bt={class:"container"},mt=n("p",{class:"text-gray-400 mb-3 font-mulish"},"Pilih Tahun Ajaran",-1),pt={class:"grid grid-cols-3 gap-3 pt-4"},ft={class:"flex flex-row justify-end text-end pt-10"};function gt(a,e,t,h,l,i){const k=o("LoadingCircle"),w=o("font-awesome-icon"),C=o("ButtonFilterYear"),P=o("accordion-header"),L=o("ButtonBayar"),j=o("accordion-content"),D=o("accordion-panel"),A=o("Accordion"),T=o("ButtonFilter"),I=o("vue-bottom-sheet");return r(),c(p,null,[l.isLoading?(r(),g(k,{key:0})):z("",!0),n("div",X,[n("header",Z,[n("div",$,[_(w,{class:"text-white",icon:"arrow-left",onClick:e[0]||(e[0]=s=>this.$router.push({name:"home"}))}),tt,at])]),n("main",et,[n("div",nt,[n("div",st,[lt,_(C,{title:l.title,value:l.selectedPeriod.length>0,onClick:i.open},null,8,["title","value","onClick"])]),n("div",it,[(r(!0),c(p,null,y(l.listBulanan,s=>(r(),g(A,{"always-open":"",key:s},{default:b(()=>[_(D,null,{default:b(()=>[_(P,null,{default:b(()=>[E(u(s.nama_bayar),1)]),_:2},1024),(r(!0),c(p,null,y(s.items,d=>(r(),g(j,{key:d},{default:b(()=>[n("div",ot,[n("div",null,[n("p",null,u(d.month_name+" "+s.period_start+" ("+s.period_start+"/"+s.period_end+")"),1),n("p",null,u(i.formatRupiah(d.bill)),1)]),_(L,{value:d,onClick:B=>i.getVal(d),check:l.history.some(B=>B.bulan_id===d.month_id)},null,8,["value","onClick","check"])])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]),n("div",rt,[n("p",null,u(l.message),1)])])])]),n("div",dt,[n("div",_t,[n("div",ut,[n("p",ht,"Total ("+u(l.bulan_id.length)+")",1),n("p",ct,u(i.formatRupiah(l.totalTagihan)),1)]),n("button",{onClick:e[1]||(e[1]=(...s)=>i.bayar&&i.bayar(...s)),class:"rounded-full border-2 text-white my-2 font-montserrat font-medium h-12 w-80 text-center bg-primaryColors"},"Lanjutkan")])]),_(I,{ref:"listPeriod"},{default:b(()=>[n("div",bt,[mt,n("div",pt,[(r(!0),c(p,null,y(l.listPeriod,s=>(r(),c("div",{key:s},[_(T,{title:s.label,value:l.selectedPeriod!=null?l.selectedPeriod.includes(s.id):"",onClick:d=>i.setSelectedPeriod(s.id)},null,8,["title","value","onClick"])]))),128))]),n("div",ft,[n("button",{class:"font-mulish text-blue-500",onClick:e[2]||(e[2]=(...s)=>a.batal&&a.batal(...s))},"Batal"),n("button",{class:"ms-12 font-mulish text-blue-500",onClick:e[3]||(e[3]=(...s)=>i.loadData&&i.loadData(...s))},"Terapkan")])])]),_:1},512)],64)}const At=v(U,[["render",gt]]);export{At as default};
