import{b as F}from"./bayar-dfd0d0ff.js";import{B as N,a as I,A as f}from"./arrayPeriod-d5354f41.js";import{R as x}from"./rupiah-c3f0a7c7.js";import{m as p}from"./mainLocalStorage-8f3300f3.js";import{q as M}from"./style-05dc6766.js";import{L as J}from"./LoadingContainer-cfea96ab.js";import{_ as k}from"./_plugin-vue_export-helper-c27b6911.js";import{o as u,c as _,a as e,t as i,A as O,C as v,r,x as y,z as R,b as c,F as b,u as B,y as d,w as Y,v as z}from"./index-daccb512.js";import{a as G,F as W,W as q,G as E}from"./flowbite-vue-29b55b18.js";import"./mainRepositories-3199904c.js";const H={name:"CustomButton",props:{check:Boolean,nominal:String},data:()=>({isClicked:null}),methods:{rupiah(s){return x.format(s)}},mounted:function(){this.isClicked=this.check}},K={class:"flex flex-col"};function U(s,t,o,h,l,n){return u(),_("div",K,[e("button",{class:O(["rounded-full px-4 text-[14px] py-1 font-mulish border-2 border-gray-300 text-white",o.nominal!=null?"bg-red-600":"bg-green-600"]),type:"button"},i(o.nominal!=null?"Batalkan":"Bayar"),3),v(" "+i(o.nominal!=null?n.rupiah(o.nominal):"")+" ",1)])}const Q=k(H,[["render",U]]);const g=F(),X={name:"bayarBebasView",components:{ButtonFilter:N,ButtonFilterYear:I,VueBottomSheet:M,LoadingCircle:J,ButtonBayarBebas:Q,Accordion:G,AccordionPanel:W,AccordionHeader:q,AccordionContent:E},data(){return{listBebas:[],listPeriod:f.getList(),sendData:null,isloading:!0,selectedPeriod:[],title:"Pilih Tahun",selesai:!1,pending:!1,total:0,message:null,arrBebas:[],arrBayar:[],inputValue:null,itemLength:0,totalPay:0}},methods:{setData(){this.sendData=JSON.stringify({nis:p.getAuth().nis,kode_sekolah:p.getAuth().kode_sekolah,period_id:this.selectedPeriod==null||this.selectedPeriod<1?f.getArray():this.selectedPeriod.map(s=>parseInt(s))})},async getBebas(){this.isloading=!0,this.setData();const s=await g.listBayarBebas(this.sendData),t=JSON.parse(s);t.success?(this.listBebas=t.data.detail.map(o=>({bebas_id:o.detail_bebas.bebas_id,bebas:o.detail_bebas.bebas,bebas_bill:o.detail_bebas.bebas_bill,bebas_total_pay:o.detail_bebas.bebas_total_pay,sisa:o.detail_bebas.sisa,nominal_pay:null})),this.isloading=t.loading,this.message=t.error):(this.isloading=t.loading,this.message=t.error)},open(){this.$refs.listPeriod.open()},close(){this.$refs.listPeriod.close()},openBayar(s){this.name_bebas=s,this.arrBebas=this.listBebas.filter(t=>t.bebas==s)[0],this.arrBayar.push(this.listBebas.filter(t=>t.bebas==s)[0]),this.$refs.bayarBottomSheet.open(),this.$refs.inputContainer.focus()},setNominal(){if(this.inputValue==null)return alert("Masukkan nominal terlebih dahulu");this.listBebas.map(s=>s.bebas==this.name_bebas?s.nominal_pay=this.inputValue:null),this.name_bebas=null,this.sum(),this.$refs.bayarBottomSheet.close(),this.inputValue=null},sum(){var s=this.arrBayar.length,t=0;s==0?t=0:s==1?t=this.arrBayar[0].nominal_pay:t=this.arrBayar.map(o=>parseInt(o.nominal_pay)).reduce((o,h)=>o+h),this.totalPay=t,this.itemLength=this.arrBayar.length==0?0:this.arrBayar.length},async bayar(){if(this.checkBayar().status==!1)this.$snackbar.add({type:"error",text:this.checkBayar().message});else{var s=this.arrBayar.map(n=>parseInt(n.bebas_id)),t=this.arrBayar.map(n=>parseInt(n.nominal_pay));const o={bebas_id:s,nominal_pay:t},h=await g.bayarBebas(o),l=JSON.parse(h);l.success?(this.$snackbar.add({type:"success",text:l.data}),this.$router.push({name:"ringkasanPembayaran"})):this.$snackbar.add({type:"error",text:l.message})}},checkBayar(){return this.arrBayar.length==0?{status:!1,message:"Pilih tagihan terlebih dahulu"}:this.totalPay<1e4?{status:!1,message:"Minimal pembayaran Rp. 10.000"}:{status:!0,message:null}},closeBayar(s){this.listBebas.map(t=>t.bebas==s.bebas?t.nominal_pay=null:null),this.arrBayar=this.arrBayar.filter(t=>t.bebas!=s.bebas),this.sum(),this.$refs.bayarBottomSheet.close()},setSelectedPeriod(s){this.selectedPeriod.includes(s)?this.selectedPeriod=this.selectedPeriod.filter(t=>t!=s):this.selectedPeriod.push(s)},batal(){this.selectedPeriod=[],this.close()},loadData(){this.getBebas(),this.close()},rupiah(s){return x.format(s)}},mounted(){this.getBebas()}},Z={class:"flex flex-col h-100"},$={class:"bg-primaryColors top-0 sticky w-full"},ee={class:"container flex flex-row items-center justify-between"},te=e("p",{class:"text-center text-white font-[20px] font-mulish py-4"},"Bayar Tagihan Bebas",-1),se=e("p",null,null,-1),ae={class:"flex-grow pt-4"},le={class:"container flex flex-col gap-y-5"},ne={class:"flex flex-row justify-between items-center"},oe=e("p",{class:"font-mulish"},"Tahun Ajaran",-1),ie={class:"flex flex-col"},re={class:"flex flex-row justify-between"},ce={class:"flex items-center justify-center"},ue={class:"bottom-0 fixed w-full flex justify-center shadow-inner bg-gray-50"},de={class:"flex flex-col py-2"},he={class:"flex flex-row justify-between"},_e={class:"font-mulish"},be={class:"font-mulish"},me={class:"container"},fe=e("p",{class:"text-gray-400 mb-3 font-mulish"},"Pilih Tahun Ajaran",-1),pe={class:"grid grid-cols-3 gap-3 pt-4"},ye={class:"flex flex-row justify-end text-end pt-10"},Be={class:"container"},ge=e("p",{class:"text-gray-400 font-mulish"},"Pembayaran Bebas",-1),xe={class:"font-mulish text-lg mt-2"},ke={class:"flex flex-row justify-between mt-2"},ve=e("p",{class:"font-mulish"},"Total Tagihan",-1),we={class:"font-mulish text-lg"},Pe={class:"flex flex-row justify-between mt-2"},Ce=e("p",{class:"font-mulish"},"Total Terbayar",-1),Ve={class:"font-mulish"},je=e("hr",null,null,-1),Ae={class:"flex flex-row justify-between mt-2"},Se=e("p",{class:"text-red-400 font-mulish"},"Kekurangan",-1),Te={class:"text-red-400 font-mulish"},De=e("small",{class:"text-center"},"Masukkan nominal yang ingin dibayar",-1);function Le(s,t,o,h,l,n){const w=r("LoadingCircle"),P=r("font-awesome-icon"),C=r("ButtonFilterYear"),V=r("accordion-header"),j=r("ButtonBayarBebas"),A=r("accordion-content"),S=r("accordion-panel"),T=r("Accordion"),D=r("ButtonFilter"),m=r("vue-bottom-sheet");return u(),_(b,null,[l.isloading?(u(),y(w,{key:0})):R("",!0),e("div",Z,[e("header",$,[e("div",ee,[c(P,{class:"text-white",icon:"arrow-left",onClick:t[0]||(t[0]=a=>this.$router.push({name:"home"}))}),te,se])]),e("main",ae,[e("div",le,[e("div",ne,[oe,c(C,{title:l.title,value:l.selectedPeriod.length>0,onClick:n.open},null,8,["title","value","onClick"])]),e("div",ie,[(u(!0),_(b,null,B(l.listBebas,a=>(u(),y(T,{"always-open":"",key:a,class:"mt-3"},{default:d(()=>[c(S,null,{default:d(()=>[c(V,{class:"header"},{default:d(()=>[v(i(a.bebas),1)]),_:2},1024),c(A,{class:"content"},{default:d(()=>[e("div",re,[e("div",null,[e("p",null,i(n.rupiah(a.bebas_bill)),1)]),c(j,{nominal:a.nominal_pay,check:a.nominal!=null,onClick:L=>a.nominal_pay!=null?n.closeBayar(a):n.openBayar(a.bebas,a.nominal)},null,8,["nominal","check","onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),e("div",ce,[e("p",null,i(l.message),1)])])])]),e("div",ue,[e("div",de,[e("div",he,[e("p",_e,"Total ("+i(l.itemLength)+")",1),e("p",be,i(n.rupiah(l.totalPay)),1)]),e("button",{onClick:t[1]||(t[1]=(...a)=>n.bayar&&n.bayar(...a)),class:"rounded-full border-2 text-white my-2 font-montserrat font-medium h-12 w-80 text-center bg-primaryColors"},"Lanjutkan")])]),c(m,{ref:"listPeriod"},{default:d(()=>[e("div",me,[fe,e("div",pe,[(u(!0),_(b,null,B(l.listPeriod,a=>(u(),_("div",{key:a},[c(D,{title:a.label,value:l.selectedPeriod!=null?l.selectedPeriod.includes(a.id):"",onClick:L=>n.setSelectedPeriod(a.id)},null,8,["title","value","onClick"])]))),128))]),e("div",ye,[e("button",{class:"font-mulish text-blue-500",onClick:t[2]||(t[2]=(...a)=>n.batal&&n.batal(...a))},"Batal"),e("button",{class:"ms-12 font-mulish text-blue-500",onClick:t[3]||(t[3]=(...a)=>n.loadData&&n.loadData(...a))},"Terapkan")])])]),_:1},512),c(m,{ref:"bayarBottomSheet"},{default:d(()=>[e("div",Be,[ge,e("p",xe,i(l.arrBebas.nama_bayar),1),e("div",ke,[ve,e("p",we,i(n.rupiah(l.arrBebas.bebas_bill)),1)]),e("div",Pe,[Ce,e("p",Ve,i(n.rupiah(l.arrBebas.bebas_total_pay)),1)]),je,e("div",Ae,[Se,e("p",Te,i(n.rupiah(parseInt(l.arrBebas.bebas_bill)-parseInt(l.arrBebas.bebas_total_pay))),1)]),Y(e("input",{ref:"inputContainer",type:"text","onUpdate:modelValue":t[4]||(t[4]=a=>l.inputValue=a),class:"border-2 mt-4 border-gray-200 rounded-md w-full p-2",placeholder:"Masukan Nominal"},null,512),[[z,l.inputValue]]),De,e("button",{onClick:t[5]||(t[5]=a=>n.setNominal(a)),class:"rounded-3xl mt-4 py-2 text-white w-full bg-primaryColors"},"Bayar")])]),_:1},512)],64)}const We=k(X,[["render",Le]]);export{We as default};
